<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="el"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CreateTableDefinition.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">SQLDomainGen</a> &gt; <a href="index.source.html" class="el_package">com.sqldomaingen.parser</a> &gt; <span class="el_source">CreateTableDefinition.java</span></div><h1>CreateTableDefinition.java</h1><pre class="source lang-java linenums">package com.sqldomaingen.parser;

import com.sqldomaingen.model.Table;
import com.sqldomaingen.model.Column;
import com.sqldomaingen.util.NamingConverter;
import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.util.ArrayList;
import java.util.List;

@Getter
<span class="nc" id="L17">@Setter</span>
<span class="fc" id="L18">@NoArgsConstructor</span>
<span class="nc" id="L19">@AllArgsConstructor</span>
public class CreateTableDefinition {
<span class="fc" id="L21">    private static final Logger logger = LoggerFactory.getLogger(CreateTableDefinition.class);</span>

<span class="fc" id="L23">    private String tableName;</span>
<span class="pc" id="L24">    private List&lt;ColumnDefinition&gt; columnDefinitions = new ArrayList&lt;&gt;();</span>
<span class="pc" id="L25">    private List&lt;String&gt; constraints = new ArrayList&lt;&gt;();</span>

    public void processCreateTable(PostgreSQLParser.CreateTableStatementContext ctx) {
<span class="fc" id="L28">        logger.info(&quot;Processing CREATE TABLE definition...&quot;);</span>

        // Extract table name
<span class="fc" id="L31">        this.tableName = extractTableName(ctx);</span>
<span class="fc" id="L32">        logger.info(&quot;Extracted table name: {}&quot;, this.tableName);</span>

        // Extract column definitions
<span class="fc" id="L35">        this.columnDefinitions = extractColumnDefinitions(ctx);</span>
<span class="fc" id="L36">        logger.info(&quot;Extracted {} columns.&quot;, this.columnDefinitions.size());</span>

<span class="fc" id="L38">    }</span>

    public String extractTableName(PostgreSQLParser.CreateTableStatementContext ctx) {
<span class="pc bpc" id="L41" title="2 of 4 branches missed.">        if (ctx.tableName() != null &amp;&amp; !ctx.tableName().isEmpty()) {</span>
<span class="fc" id="L42">            String rawTableName = ctx.tableName(0).getText();</span>
<span class="fc" id="L43">            return NamingConverter.toPascalCase(rawTableName);</span>
        } else {
<span class="nc" id="L45">            throw new IllegalArgumentException(&quot;Table name not found in CREATE TABLE statement.&quot;);</span>
        }
    }

    public List&lt;ColumnDefinition&gt; extractColumnDefinitions(PostgreSQLParser.CreateTableStatementContext ctx) {
<span class="fc" id="L50">        List&lt;ColumnDefinition&gt; extractedColumns = new ArrayList&lt;&gt;();</span>

        // Extract columns from column_def rule
<span class="pc bpc" id="L53" title="1 of 2 branches missed.">        if (ctx.columnDef() != null) {</span>
<span class="fc bfc" id="L54" title="All 2 branches covered.">            for (PostgreSQLParser.ColumnDefContext columnCtx : ctx.columnDef()) {</span>
<span class="fc" id="L55">                ColumnDefinition column = new ColumnDefinition();</span>

                // Extract column name
<span class="fc" id="L58">                String columnName = columnCtx.columnName().getText();</span>
<span class="fc" id="L59">                column.setColumnName(columnName);</span>

                // Extract data type
<span class="fc" id="L62">                String dataType = columnCtx.dataType().getText();</span>
<span class="fc" id="L63">                column.setSqlType(dataType);</span>

<span class="fc" id="L65">                extractedColumns.add(column);</span>
<span class="fc" id="L66">                logger.info(&quot;Extracted column: {} with type {}&quot;, columnName, dataType);</span>
<span class="fc" id="L67">            }</span>
        } else {
<span class="nc" id="L69">            logger.warn(&quot;No columns found in the CREATE TABLE statement.&quot;);</span>
        }

<span class="fc" id="L72">        return extractedColumns;</span>
    }


    public Table toTable() {
<span class="fc" id="L77">        Table table = new Table();</span>
<span class="fc" id="L78">        table.setName(this.tableName);</span>

<span class="fc" id="L80">        List&lt;Column&gt; columns = this.columnDefinitions.stream()</span>
<span class="fc" id="L81">                .map(ColumnDefinition::toColumn)</span>
<span class="fc" id="L82">                .toList();</span>
<span class="fc" id="L83">        table.setColumns(columns);</span>

<span class="fc" id="L85">        table.addConstraints(this.constraints);</span>
<span class="fc" id="L86">        logger.info(&quot;Converted to Table object: {} with {} columns.&quot;, table.getName(), columns.size());</span>
<span class="fc" id="L87">        return table;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>